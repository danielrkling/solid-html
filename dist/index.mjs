import{ErrorBoundary as e,For as t,Index as n,Match as r,Show as i,Suspense as a,Switch as o,createComponent as s,mergeProps as c}from"solid-js";import{SVGElements as l,insert as u,spread as d}from"solid-js/web";const f=`IDENTIFIER`,p=`Attr`,m=`Text`,h=e=>g(e)||e>=48&&e<=58||e===46||e===45,g=e=>e>=65&&e<=90||e>=97&&e<=122||e===95||e===36,_=e=>e>=9&&e<=13||e===32,v=`TEXT`,y=`ATTR_VALUE`,b=`RAW_TEXT`,x=`COMMENT`;function S(e,t){let n=[],r=v,i=``,a=``,o=0;for(let s=0;s<e.length;s++){let c=e[s],l=c.length;for(o=0;o<l;)switch(r){case v:{a=``;let e=c.indexOf(`<`,o);e===-1?(o<l&&n.push({type:m,value:c.slice(o)}),o=l):(e>o&&n.push({type:m,value:c.slice(o,e)}),c[e+1]===`!`&&c[e+2]===`-`&&c[e+3]===`-`?(r=x,o=e+4):(n.push({type:`<`}),r=`TAG`,o=e+1));break}case`TAG`:{let e=c.charCodeAt(o);if(_(e))o++;else if(e===62)n.push({type:`>`}),r=t.has(a)?b:v,o++;else if(e===61)n.push({type:`=`}),o++;else if(e===47)n.push({type:`/`}),o++;else if(e===34||e===39){let e=c[o];n.push({type:`'`,value:e}),i=e,r=y,o++}else if(g(e)){let e=o;for(;o<l&&h(c.charCodeAt(o));)o++;let t=c.slice(e,o);a===``&&(a=t),n.push({type:f,value:t})}else if(e===46&&c[o+1]===`.`&&c[o+2]===`.`)n.push({type:`...`}),o+=3;else throw Error(`Unexpected Character: ${c[o]}`);break}case y:{let e=c.indexOf(i,o);e===-1?(n.push({type:p,value:c.slice(o)}),o=l):(e>o&&n.push({type:p,value:c.slice(o,e)}),n.push({type:`'`,value:i}),r=`TAG`,i=``,o=e+1);break}case b:{let e=`</${a}>`,t=c.indexOf(e,o);a=``,t===-1?(n.push({type:m,value:c.slice(o)}),o=l):(t>o&&n.push({type:m,value:c.slice(o,t)}),r=v,o=t);break}case x:{let e=c.indexOf(`-->`,o);e===-1?o=l:(r=v,o=e+3);break}}s<e.length-1&&r!==x&&n.push({type:"${}",value:s})}return n}const C=`Root`,w=`Elem`,T=`Text`,E=`Expression`,D=`Bool`,O=`Static`,k=`Expression`,A=`Spread`,j=`Mixed`;function M(e,t){let n={type:C,children:[]},r=[n],i=0,a=e.length;for(;i<a;){let n=e[i],o=r[r.length-1];switch(n.type){case m:{let t=n.value;if(t.trim()===``){let t=e[i-1]?.type,n=e[i+1]?.type;if(t===`>`||n===`<`){i++;continue}}o.children.push({type:T,value:t}),i++;continue}case"${}":o.children.push({type:E,value:n.value}),i++;continue;case`<`:{i++;let n=e[i];if(n.type===`/`){i++;let n=e[i];if(r.length>1&&n?.type===f&&r[r.length-1].name===n.value){let e=r.pop();e?.type===w&&t.has(e.name)&&(e.children=[]),i+=2;continue}throw Error(`Mismatched closing tag.`)}if(n.type===f){let t=n.value,s={type:w,name:t,props:[],children:[]};for(o.children.push(s),i++;i<a;){let t=e[i];if(t.type===`>`||t.type===`/`)break;if(t.type===`...`){let t=e[i+1];if(t?.type==="${}")s.props.push({type:A,value:t.value}),i+=2;else throw Error(`Spread operator must be followed by an expression.`)}else if(t.type===f){let n=t.value,r=e[i+1];if(r?.type===`=`){i+=2;let t=e[i];if(t.type==="${}")s.props.push({name:n,type:k,value:t.value}),i++;else if(t.type===`'`){let r=t.value;i++;let o=[];for(;i<a&&e[i].type!==`'`;){let t=e[i++];t.value!==``&&o.push(t.value)}if(i++,o.length===0)s.props.push({name:n,type:O,value:``,quote:r});else if(o.length===1){let e=o[0];s.props.push({name:n,type:typeof e==`string`?O:k,value:e,quote:r})}else s.props.push({name:n,type:j,value:o,quote:r})}}else s.props.push({type:D,name:n,value:!0}),i++}else throw Error(`Invalid attribute.`)}let c=e[i];c.type===`/`?i+=2:c.type===`>`&&(i++,r.push(s));continue}}default:throw Error(`Unexpected token: ${JSON.stringify(n)}`)}}if(r.length>1)throw Error(`Unclosed tag found.`);return n}function N(e){return e.length===1?e[0]:e}function P(e){for(;typeof e==`function`;)e=e();return e}function F(e){let t=e.name;if(typeof t==`number`)return!0;let n=t.charCodeAt(0);return n>=65&&n<=90}const I=new Set([`area`,`base`,`br`,`col`,`embed`,`hr`,`img`,`input`,`link`,`meta`,`param`,`source`,`track`,`wbr`]),L=new Set([`script`,`style`,`textarea`,`title`]);function R(e){if(e.type===C||e.type===w&&F(e)){if(e.children.some(e=>e.type===w&&!F(e))){let t=document.createElement(`template`);t.innerHTML=e.children.map(z).join(``),e.template=t}e.children.forEach(R)}else e.type===w&&!F(e)&&e.children.forEach(R)}function z(e){switch(e.type){case T:return e.value;case E:return`<!--+-->`;case w:if(F(e))return`<!--+-->`;let t=``;return e.props.some(e=>e.type===A)||(e.props=e.props.filter(e=>{if(e.type===O){t+=` ${e.name}=${e.quote}${e.value}${e.quote}`;return}else if(e.type===D){t+=` ${e.name}`;return}return!0})),`<${e.name}${t}>${e.children.map(z).join(``)}</${e.name}>`}}const B=new WeakMap,V=document.createTreeWalker(document,133);function H(e){function t(t,...n){let r=U(t);return G(r,n,e)}return t.components=e,t.sld=t,t.define=function(t){return H({...e,...t})},t}function U(e){let t=B.get(e);return t||(t=M(S(e,L),I),R(t),B.set(e,t)),t}function W(e,t,n){switch(e.type){case T:return e.value;case E:return t[e.value];case w:let r=e.name,i;if(typeof r==`number`){let e=t[r];if(typeof e==`function`)i=e;else if(typeof e==`string`)r=e;else throw Error(`Dynamic element name must be a string or component`)}else if(typeof r==`string`&&F(e)&&(i=n[r],!i))throw Error(`Component "${r}" not found in registry`);if(i)return s(i,K(e,t,n));let a=l.has(r),o=a?document.createElementNS(`http://www.w3.org/2000/svg`,r):document.createElement(r),c=K(e,t,n);return d(o,c,a,!0),o}}function G(e,t,n){if(!e.template)return N(e.children.map(e=>W(e,t,n)));let r=e.template.content.cloneNode(!0);V.currentNode=r,i(e.children);function i(e){for(let r of e){let e=V.nextNode();if(r.type===w){let a=typeof r.name==`number`||n[r.name];if(a){u(e.parentNode,W(r,t,n),e),V.currentNode=e;continue}if(r.props.length){let i=K(r,t,n);d(e,i,l.has(r.name),!0)}i(r.children)}else r.type===E&&(u(e.parentNode,W(r,t,n),e),V.currentNode=e)}}return Array.from(r.childNodes)}function K(e,t,n,r={}){for(let n of e.props)switch(n.type){case D:r[n.name]=!0;break;case O:r[n.name]=n.value;break;case k:q(r,n.name,t[n.value]);break;case j:let e=()=>n.value.map(e=>typeof e==`number`?P(t[e]):e).join(``);q(r,n.name,e);break;case A:let i=t[n.value];if(!i||typeof i!=`object`)throw Error(`Can only spread objects`);r=c(r,i);break}return e.children.length&&Object.defineProperty(r,`children`,{get(){return G(e,t,n)}}),r}function q(e,t,n){typeof n==`function`&&n.length===0&&t!==`ref`&&!t.startsWith(`on`)?Object.defineProperty(e,t,{get(){return n()},enumerable:!0}):e[t]=n}const J={For:t,Index:n,Match:r,Suspense:a,ErrorBoundary:e,Show:i,Switch:o},Y=H(J);var X=Y;const Z=Y.define;function Q(e){return t=>s(e,t)}export{Z as SLD,H as createSLD,X as default,J as defaultComponents,M as parse,Q as run,Y as sld};